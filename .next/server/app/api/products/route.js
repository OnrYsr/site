(()=>{var e={};e.id=3146,e.ids=[3146],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12104:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>u});var a=r(96559),i=r(48088),n=r(37719),c=r(32190);let o=new(r(96330)).PrismaClient;async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("category"),s=t.get("search"),a=t.get("sortBy")||"featured",i=t.get("featured"),n={isActive:!0};if(r&&"all"!==r){let e=await o.category.findUnique({where:{slug:r}});e&&(n.categoryId=e.id)}s&&(n.OR=[{name:{contains:s,mode:"insensitive"}},{description:{contains:s,mode:"insensitive"}}]),"true"===i&&(n.isFeatured=!0);let u={};switch(a){case"price-low":u={price:"asc"};break;case"price-high":u={price:"desc"};break;case"newest":u={createdAt:"desc"};break;case"name":u={name:"asc"};break;default:u=[{isFeatured:"desc"},{createdAt:"desc"}]}let d=(await o.product.findMany({where:n,orderBy:u,include:{category:{select:{name:!0,slug:!0}},discounts:{where:{isActive:!0,startDate:{lte:new Date},endDate:{gte:new Date}}},reviews:{select:{rating:!0}}}})).map(e=>{let t=e.discounts[0],r=e.reviews.length,s=r>0?e.reviews.reduce((e,t)=>e+t.rating,0)/r:0;return{id:e.id,name:e.name,slug:e.slug,description:e.description,price:Number(e.price),originalPrice:e.originalPrice?Number(e.originalPrice):null,images:e.images,stock:e.stock,isActive:e.isActive,isFeatured:e.isFeatured,category:e.category.name,categorySlug:e.category.slug,rating:Math.round(10*s)/10,reviews:r,discount:t?t.percentage:null,badgeText:t?.badgeText||null,badgeColor:t?.badgeColor||null,isNew:e.createdAt>new Date(Date.now()-2592e6),createdAt:e.createdAt,updatedAt:e.updatedAt}});return c.NextResponse.json({success:!0,data:d,count:d.length})}catch(e){return console.error("Products API Error:",e),c.NextResponse.json({success:!1,error:"\xdcr\xfcnler y\xfcklenirken hata oluÅŸtu"},{status:500})}finally{await o.$disconnect()}}let d=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/Users/home/Desktop/site/src/app/api/products/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:g}=d;function m(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580],()=>r(12104));module.exports=s})();